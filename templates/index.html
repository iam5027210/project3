<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¬ìƒ ëª©ë¡</title>
    <style>
        /* âœ… ì „ì²´ ë°°ê²½ì„ ì™„ì „ ë¸”ë™ìœ¼ë¡œ ë³€ê²½ */
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            background-color: #000000;
            /* ì™„ì „ ë¸”ë™ */
            color: #E0E0E0;
            /* ë¶€ë“œëŸ¬ìš´ í°ìƒ‰ (ëˆˆë¶€ì‹¬ ë°©ì§€) */
        }

        /* âœ… ë©”ì¸ ì œëª© ìŠ¤íƒ€ì¼ (ë” ê·¹ì¥ ê°™ì€ ë¶„ìœ„ê¸°) */
        h1 {
            font-size: 36px;
            font-weight: bold;
            letter-spacing: 2px;
            color: #FFFFFF;
            text-shadow: 0 4px 12px rgba(255, 255, 255, 0.3);
            /* ì€ì€í•œ ë„¤ì˜¨ ì¡°ëª… ëŠë‚Œ */
            margin-bottom: 30px;
        }

        /* âœ… ë¹„ë””ì˜¤ ëª©ë¡ (ìµœì í™”ëœ ë ˆì´ì•„ì›ƒ) */
        .video-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
            justify-content: center;
        }

        /* âœ… ë¹„ë””ì˜¤ ì¹´ë“œ ìŠ¤íƒ€ì¼ (ë” ê³ ê¸‰ìŠ¤ëŸ½ê³  ë¶€ë“œëŸ¬ìš´ ëŠë‚Œ) */
        .video {
            background: rgb(255, 255, 255);
            /* ë¸”ë™ ë°°ê²½ ìœ„ì— ì•½ê°„ì˜ íˆ¬ëª…ê° ì¶”ê°€ */
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
            /* ë¶€ë“œëŸ¬ìš´ ê·¹ì¥ ì¡°ëª… íš¨ê³¼ */
            transition: transform 0.3s ease-in-out, box-shadow 0.3s;
        }

        /* âœ… ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦´ ë•Œ ë¶€ë“œëŸ¬ìš´ ì¡°ëª… íš¨ê³¼ ì¶”ê°€ */
        .video:hover {
            transform: scale(1.05);
            /* ì‚´ì§ í™•ëŒ€ */
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.2);
            /* ë¶€ë“œëŸ¬ìš´ ë„¤ì˜¨ ì¡°ëª… */
        }

        /* âœ… ë¹„ë””ì˜¤ ì¸ë„¤ì¼ ìŠ¤íƒ€ì¼ (ë” ì„¸ë ¨ë˜ê²Œ) */
        .video img {
            width: 100%;
            border-radius: 8px;
            transition: opacity 0.3s, transform 0.3s;
        }

        /* âœ… ì¸ë„¤ì¼ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ ì‚´ì§ ì–´ë‘ì›Œì§€ëŠ” íš¨ê³¼ */
        .video:hover img {
            opacity: 0.85;
            transform: scale(1.02);
            /* ì•½ê°„ í™•ëŒ€ */
        }

        /* âœ… ë¹„ë””ì˜¤ ì œëª© ìŠ¤íƒ€ì¼ (ëˆˆì´ í¸í•œ ìƒ‰ìƒê³¼ ì…ì²´ê° ì¶”ê°€) */
        .video p {
            font-size: 16px;
            font-weight: 600;
            margin-top: 10px;
            color: #030303;
            /* ë¶€ë“œëŸ¬ìš´ í°ìƒ‰ (ëˆˆì— ëœ í”¼ë¡œí•¨) */

        }

        /* âœ… ì›¹ìº  ìŠ¤íŠ¸ë¦¬ë° ì»¨í…Œì´ë„ˆ */
        #webcam-container {
            text-align: center;
            margin-bottom: 20px;
        }



    </style>
</head>

<body>
    <h1>í‘œì •ìœ¼ë¡œ ì•Œì•„ë³´ëŠ” ìŠ¤íŠ¸ë¦¬ë° ì°ë°˜ì‘</h1>



    <!-- âœ… ì›¹ìº  ìŠ¤íŠ¸ë¦¬ë° ì»¨í…Œì´ë„ˆ (ê¸°ë³¸ì ìœ¼ë¡œ ë³´ì´ë„ë¡ ì„¤ì •) -->
    <div id="webcam-container">
        <img id="webcam-feed" src="/video_feed" style="width:200px; height:auto; border-radius:10px;">
    </div>

    <div class="video-container">
        {% for video in videos %}
        <div class="video">
            {% set raw_url = video.get('url', '') %}
            {% if 'watch?v=' in raw_url %}
            {% set video_id = raw_url.split('?v=')[-1].split('&')[0] %}
            {% elif '/shorts/' in raw_url %}
            {% set video_id = raw_url.split('/shorts/')[-1].split('?')[0] %}
            {% else %}
            {% set video_id = raw_url.split('/')[-1].split('?')[0] %}
            {% endif %}
            <a href="/video/{{ video_id }}">
                <img src="https://img.youtube.com/vi/{{ video_id }}/0.jpg" alt="{{ video.get('title', 'No Title') }}">
                <p>{{ video.get('title', video_id) }}</p>
            </a>
        </div>
        {% endfor %}
    </div>
    <script>
        // let sessionId = "";  // âœ… ì„¸ì…˜ ID ì €ì¥ ë³€ìˆ˜
        // let videoId = "none";  // âœ… ë©”ì¸ í™”ë©´ì—ì„œëŠ” ê¸°ë³¸ê°’ ì‚¬ìš©
        // let popupShown = false; // íŒì—… í‘œì‹œ ì—¬ë¶€






        // âœ… ì›¹ìº  í™”ë©´ì„ ìˆ¨ê¸¸ ìˆ˜ ìˆë„ë¡ ì¡°ì‘í•˜ëŠ” í•¨ìˆ˜
        function toggleWebcamVisibility(visible) {
            document.getElementById("webcam-container").style.display = visible ? "block" : "none";
        }

        // // âœ… í˜ì´ì§€ê°€ ë¡œë“œë  ë•Œ ê¸°ë³¸ì ìœ¼ë¡œ ì›¹ìº ì„ ì‹¤í–‰í•˜ê³ , ì´í›„ ì œì–´ ê°€ëŠ¥
        // document.addEventListener("DOMContentLoaded", function () {
        //     toggleWebcamVisibility(true); // ê¸°ë³¸ì ìœ¼ë¡œ ì›¹ìº  í‘œì‹œ
        // });


        document.addEventListener("DOMContentLoaded", function () {
            fetch('/get_session_id')  // âœ… ì„¸ì…˜ ID ìš”ì²­
                .then(response => response.json())
                .then(data => {
                    sessionId = data.session_id;
                    let webcamFeed = document.getElementById("webcam-feed");
                    webcamFeed.src = `/video_feed/${videoId}/${sessionId}`;  // âœ… ì˜¬ë°”ë¥¸ URL í˜•ì‹ ì ìš©
                })
                .catch(error => console.error("âŒ ì„¸ì…˜ ID ìš”ì²­ ì‹¤íŒ¨:", error));
            // âœ… íŒì—…ì°½ì—ì„œ ì›¹ìº  ì‹¤í–‰
           // document.getElementById("popup").style.display = "flex";
            //toggleWebcamVisibility(false);  // âœ… ì›¹ìº  ê¸°ë³¸ í‘œì‹œ  

            // âœ… localStorageì—ì„œ 'ì˜¤ëŠ˜ í•˜ë£¨ ë‹«ê¸°' ì„¤ì • í™•ì¸
            let popupClosedToday = localStorage.getItem("popupClosedToday");

            if (popupClosedToday === "true") {
                console.log("ğŸ›‘ ì˜¤ëŠ˜ í•˜ë£¨ ë™ì•ˆ íŒì—… í‘œì‹œ ì•ˆí•¨");
                document.getElementById("popup").style.display = "none";
                document.getElementById("webcam-container").classList.add("hidden"); // ì›¹ìº  ìˆ¨ê¹€
            } else {
                console.log("âœ… íŒì—… í‘œì‹œ");
                document.getElementById("popup").style.display = "flex"; // íŒì—… í‘œì‹œ
            }

            // âœ… íŒì—… ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
            document.getElementById("close-popup-btn").addEventListener("click", function () {
                closePopup();
            });
            // âœ… ì„œë²„ì—ì„œ ì„¸ì…˜ ID ë° íŒì—… ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
            // fetch('/get_session_id')
            //     .then(response => response.json())
            //     .then(data => {
            //         let sessionId = data.session_id;  // âœ… ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ì„¸ì…˜ ID ì‚¬ìš©
            //         let popupShown = data.popup_shown;
            //         console.log("âœ… í˜„ì¬ ì„¸ì…˜ ID:", sessionId, "| íŒì—… í‘œì‹œ ì—¬ë¶€:", popupShown);

            //         // âœ… ì„¸ì…˜ì—ì„œ íŒì—…ì´ ë‹«í˜”ëŠ”ì§€ í™•ì¸
            //         if (!popupShown) {
            //             console.log("âœ… ìƒˆ ì„¸ì…˜ - íŒì—… í‘œì‹œ");
            //             document.getElementById("popup").style.display = "flex"; // íŒì—… í‘œì‹œ
            //         } else {
            //             console.log("ğŸ›‘ ì´ì „ì— ë°©ë¬¸í•œ ì„¸ì…˜ - íŒì—… í‘œì‹œ ì•ˆí•¨");
            //             document.getElementById("popup").style.display = "none";
            //             document.getElementById("webcam-container").classList.add("hidden"); // ì›¹ìº  ìˆ¨ê¹€
            //         }

            //         // âœ… íŒì—… ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€ (ì„¸ì…˜ ìœ ì§€)
            //         document.getElementById("close-popup-btn").addEventListener("click", function () {
            //             console.log("ğŸ“¢ íŒì—… ë‹«ê¸° ë²„íŠ¼ í´ë¦­ë¨!");
            //             closePopup(sessionId);
            //         });
            //     })
            //     .catch(error => console.error("âŒ ì„¸ì…˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:", error));
        });





    </script>
</body>

</html>